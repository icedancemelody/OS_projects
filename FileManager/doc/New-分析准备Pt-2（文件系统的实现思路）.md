> 为操作系统课设做的一些分析准备

结合前两个基础章节分析笔记，思考具体的实现思路，当然还需要逐步验证是否可行 ;-)

- **功能需求**

  - 显示系统信息，-help 可查看文件系统支持的命令
  - 用户的操作通过命令实现
  - 用户的创建
  - 目录的创建，删除，更改，显示，搜索
  - 文件的创建，打开，删除，复制，显示，修改，保存，*共享*

- **模块算法（设计内容）**

  - 物理盘块设计：磁盘 1MB ，磁盘块 16 B，共有 2^26 个磁盘块

  - 目录的设计：

    - 目录项 FCB 的设计：

      - 用户可见的字段：文件名，文件类型，创建时间，共享计数器
      - 用户不可见字段：文件的首块物理盘块指针

      **那么，从用户能看到的角度，FCB 就是文件相关的属性信息**

    - 目录表 FCB_List 的设计：动态数组 ArrayList\<FCB> 来存取每一个用户表项

      **那么，从用户能看到的角度，FCB_List 就是文件夹**

    - 目录结构设计：无环图目录结构，因此每个文件附加一个共享计数器字段，来代表共享此文件的用户数量

    - 目录搜索设计：FCB 放在动态数组里，那么用户打开一个文件或者目录文件时，系统背后其实是遍历动态数组 FCB_List，即可搜索出该用户的文件

  - 用户的结构设计：用户的名字，账号，密码，以及改用户拥有的磁盘文件信息，从中可以看出，若验证登录后，进入的应该是一个文件夹（背后就是一个 FBC_List ），里面用户可以创建和共享文件，所以创建后的文件，文件应该可以提供 "共享" 操作，分享给指定的用户，那么下一次那个用户登录时，能看到那个文件，不做权限管理，那么默认就是 "完全控制" 权限

  - 文件共享方式设计：索引结点结构的硬链接方式共享。但因为用的是普通的 FCB ，那么共享计数器这个字段直接放在 FCB 里就好，上面说到有创建的文件提供 "共享" 的操作，那么共享后，共享计数器就会加一，并且分享给指定的用户那个用户会出现对应的文件，所以，他的 FCB_List 会增加一个 FCB ，那么当两者删除文件时，只有共享计数器为 0 时，才会真正删除文件，磁盘块才会回收

  - 文件的逻辑结构设计：无结构文件，字段有文件名、创建时间、文件类型、共享计数器（int 类型）、数据信息（String 类型）

  - 文件的物理结构设计：显示链接分配方式，因此会有一个 FAT （文件分配表）结构来存物理号的下一块，而 FCB 中存的就是起始块号，那么这里就会有个物理块，也就是磁盘块，创建文件时根据输入的文件数据来计算文件的大小，然后计算需要多少个逻辑块来存储，在位示图中查找哪一个是空闲的，然后依次分配，就是把空闲的那个磁盘块号标记为 0 代表不可用，然后在FAT的的表项中，对应的逻辑块号的下一块号的值依次赋值

  - 空闲磁盘管理的设计算法：空闲表法对应连续分配方式，位示图法对应链接分配方式，如果上面选择的是显示链接分配，那么这里就要选位示图法来管理空闲磁盘

  - 用户信息储存：把系统现在的信息序列化到一个文件，系统启动，反序列化文件来启动，能读取用户的信息，用户的目录信息，文件信息

